# -*- coding: utf-8 -*-
"""car price

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1s7KTZhkU_qRn1yXjUviOpu0WPzpc4zcq
"""

# Commented out IPython magic to ensure Python compatibility.
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
# %matplotlib inline
pd.options.display.max_rows = 999

df=pd.read_csv('car.csv')
df.head()

df.shape

df.isnull().sum()

df.corr()

sns.pairplot(df)

plt.figure(figsize=(30,20))
g=sns.heatmap(df.corr(),annot=True,cmap="RdYlGn")

"""## FEATURE ENGINEERING"""

df.head()

df['year'] = 2020 - df['Year']
df.head()

df.iloc[56]

df.iloc[74]

df.iloc[61]

df.iloc[81]

df['Car_Name'].unique()

df['Car_Name'].value_counts()

df['Car_Name'] = df['Car_Name'].str.replace('ritz','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('sx4','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('ciaz','Maruti Suzuki ciaz')
df['Car_Name'] = df['Car_Name'].str.replace('wagon r','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('swift','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('vitara brezza','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('s cross','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('alto 800','Maruti Suzuki alto')
df['Car_Name'] = df['Car_Name'].str.replace('ertiga','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('dzire','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('alto k10','Maruti Suzuki alto')
df['Car_Name'] = df['Car_Name'].str.replace('ignis','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('800','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('baleno','Maruti Suzuki')
df['Car_Name'] = df['Car_Name'].str.replace('omni','Maruti Suzuki')

df['Car_Name'] = df['Car_Name'].str.replace('fortuner','Toyota fortuner')
df['Car_Name'] = df['Car_Name'].str.replace('innova','Toyota innova')
df['Car_Name'] = df['Car_Name'].str.replace('corolla altis','Toyota corolla')
df['Car_Name'] = df['Car_Name'].str.replace('etios cross','Toyota etios')
df['Car_Name'] = df['Car_Name'].str.replace('etios g','Toyota etios')
df['Car_Name'] = df['Car_Name'].str.replace('etios liva','Toyota etios')
df['Car_Name'] = df['Car_Name'].str.replace('corolla','Toyota corolla')
df['Car_Name'] = df['Car_Name'].str.replace('etios gd','Toyota etios')
df['Car_Name'] = df['Car_Name'].str.replace('camry','Toyota camry')
df['Car_Name'] = df['Car_Name'].str.replace('land cruiser','Toyota land cruiser')
df['Car_Name'] = df['Car_Name'].str.replace('Royal Enfield Thunder 500','Royal Enfield Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Royal Enfield Classic 350','Royal Enfield Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Royal Enfield Thunder 350','Royal Enfield Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Royal Enfield Bullet 350','Royal Enfield Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Royal Enfield Classic 500','Royal Enfield Bike')
df['Car_Name'] = df['Car_Name'].str.replace('KTM RC200','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('KTM RC390','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('KTM 390 Duke','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar RS200','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Dominar 400','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Avenger 220','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Avenger 150','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar 150','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Avenger 150 street','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Avenger 220 dtsi','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar  NS 200','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar 220 F','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar NS 200','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Avenger Street 220','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Pulsar 135 LS','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Discover 100','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Discover 125','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj  ct 100','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Bike dtsi','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Bike street','Bajaj Bike')

df['Car_Name'] = df['Car_Name'].str.replace('UM Renegade Mojave','UM Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Mahindra Mojo XT300','Mahindra Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Suzuki Access 125','Suzuki Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hyosung GT250R','Hyosung Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha FZ S V 2.0','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha FZ 16','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha FZ  v 2.0','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha Fazer','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha FZ S','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Apache RTR 160','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Apache RTR 180','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Sport','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Jupyter','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Wego','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CB Hornet 160R','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CBR 150','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda Activa 4G','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Activa 4g','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Activa 3g','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda Dream Yuga','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CB Trigger','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CB Unicorn','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda Karizma','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda Activa 125','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CB Shine','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda CB twister','Honda Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Extreme','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Passion X pro','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Splender iSmart','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Passion Pro','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Splender Plus','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Glamour','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Super Splendor','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Hunk','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero  Ignitor Disc','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero  CBZ Xtreme','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Honda CBZ extreme','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Hero Honda Passion Pro','Hero Bike')
df['Car_Name'] = df['Car_Name'].str.replace('eon','Hyundai eon')
df['Car_Name'] = df['Car_Name'].str.replace('verna','Hyundai verna')
df['Car_Name'] = df['Car_Name'].str.replace('i20','Hyundai i20')
df['Car_Name'] = df['Car_Name'].str.replace('grand i10','Hyundai grand i10')
df['Car_Name'] = df['Car_Name'].str.replace('i10','Hyundai')
df['Car_Name'] = df['Car_Name'].str.replace('xcent','Hyundai')
df['Car_Name'] = df['Car_Name'].str.replace('elantra','Hyundai')
df['Car_Name'] = df['Car_Name'].str.replace('creta','Hyundai')
df['Car_Name'] = df['Car_Name'].str.replace('amaze','Honda amaze')
df['Car_Name'] = df['Car_Name'].str.replace('city','Honda city')
df['Car_Name'] = df['Car_Name'].str.replace('brio','Honda brio')
df['Car_Name'] = df['Car_Name'].str.replace('jazz','Honda jazz')

df.head()

df['Car_Name'].unique()

df['Car_Name'] = df['Car_Name'].str.replace('Bajaj Bike ','Bajaj Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Yamaha Bike ','Yamaha Bike')
df['Car_Name'] = df['Car_Name'].str.replace('TVS Bike ','TVS Bike')
df['Car_Name'] = df['Car_Name'].str.replace('Honda Bike ','Honda Bike')

df.head()

df['Car_Name'].unique()

df['Car_Name'] = df['Car_Name'].str.replace('etioMaruti Suzuki','Toyota')
df['Car_Name'] = df['Car_Name'].str.replace('Toyotad','Toyota')
df['Car_Name'] = df['Car_Name'].str.replace('Toyota Toyota corolla','Toyota corolla')
df['Car_Name'] = df['Car_Name'].str.replace('Toyota etiosd','Toyota etios')
df['Car_Name'] = df['Car_Name'].str.replace('Hyundai grand Hyundai','Hyundai grand i10')

df['Car_Name'].unique()

df.head()

print(df['Fuel_Type'].unique())
print(df['Seller_Type'].unique())
print(df['Transmission'].unique())
print(df['Owner'].unique())

dummy_cols = pd.get_dummies(df.Fuel_Type)
df = pd.concat([df,dummy_cols], axis='columns')

dummy_cols = pd.get_dummies(df.Seller_Type)
df = pd.concat([df,dummy_cols], axis='columns')

dummy_cols = pd.get_dummies(df.Transmission)
df = pd.concat([df,dummy_cols], axis='columns')

dummy_cols = pd.get_dummies(df.Car_Name)
df = pd.concat([df,dummy_cols], axis='columns')

df.drop(['Year', 'Fuel_Type', 'Seller_Type', 'Transmission', 'Car_Name'],axis=1,inplace=True)

fig, ax = plt.subplots(2,3,figsize = (30,15))
sns.distplot(df["year"], kde =True, ax=ax[0,0], color = "blue")
sns.distplot(df["Selling_Price"], kde =True, ax=ax[0,1], color = "black")
sns.distplot(df["Present_Price"], kde =True, ax=ax[0,2], color = "magenta")
sns.distplot(df["Kms_Driven"], kde =True, ax=ax[1,0])

u=df['Kms_Driven'].mean()+3*df['Kms_Driven'].std()
l=df['Kms_Driven'].mean()-3*df['Kms_Driven'].std()
u,l

df.loc[df['Kms_Driven']>70000, 'Kms_Driven']=70000

df.head()

fig, ax = plt.subplots(2,3,figsize = (30,15))
sns.distplot(df["year"], kde =True, ax=ax[0,0], color = "blue")
sns.distplot(df["Selling_Price"], kde =True, ax=ax[0,1], color = "black")
sns.distplot(df["Present_Price"], kde =True, ax=ax[0,2], color = "magenta")
sns.distplot(df["Kms_Driven"], kde =True, ax=ax[1,0])

X=df.iloc[:,1:]
y=df.iloc[:,0]

X.head()

y.head()

from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=0)

from sklearn.ensemble import GradientBoostingRegressor
clf=GradientBoostingRegressor(n_estimators = 400, max_depth = 5, min_samples_split = 2, learning_rate = 0.1)
clf.fit(X_train,y_train)

import json
columns = {
    'data_columns' : [col.lower() for col in X.columns]
}
with open("columns.json","w") as f:
    f.write(json.dumps(columns))

import pickle
pickle.dump(clf, open('model.pkl', 'wb'))